name: macOS GUI Absolute Path Fix
on: workflow_dispatch

jobs:
  gui-session:
    runs-on: macos-latest
    timeout-minutes: 360 

    steps:
      - name: Instalaci칩n y Localizaci칩n
        run: |
          # 1. Instalar herramientas
          brew install cloudflare/cloudflare/cloudflared tiger-vnc
          
          # 2. Encontrar la ruta real de forma din치mica y guardarla
          VNC_PATH=$(ls -d /opt/homebrew/Cellar/tiger-vnc/*/bin | head -n 1)
          CF_PATH=$(ls -d /opt/homebrew/Cellar/cloudflared/*/bin | head -n 1)
          
          echo "VNC est치 en: $VNC_PATH"
          echo "Cloudflared est치 en: $CF_PATH"
          
          # 3. Configurar carpeta y contrase침a
          mkdir -p ~/.vnc
          echo "123456" | $VNC_PATH/vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          
          # 4. Iniciar el servidor
          $VNC_PATH/vncserver :1 -geometry 1280x720 -depth 24 -localhost no
          
          # 5. Iniciar t칰nel
          $CF_PATH/cloudflared tunnel --url tcp://localhost:5901 > tunnel.log 2>&1 &
          
          sleep 20
          echo "-------------------------------------------------------"
          echo "游댕 URL PARA TU CMD DE WINDOWS:"
          URL=$(grep -oE "https://[a-zA-Z0-9.-]+\.trycloudflare\.com" tunnel.log | sed 's/https:\/\///')
          echo "$URL"
          echo "-------------------------------------------------------"
          echo "游 PASOS EN WINDOWS:"
          echo "1. .\cloudflared-windows-amd64.exe access tcp --hostname $URL --listener localhost:5901"
          echo "2. TigerVNC: localhost:5901 (Clave: 123456)"
          echo "-------------------------------------------------------"
          
          sleep 21600
