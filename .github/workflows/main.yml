name: macOS GUI via Docker (Final)
on: workflow_dispatch

jobs:
  gui-session:
    runs-on: macos-latest
    timeout-minutes: 360 

    steps:
      - name: Instalar Cloudflared
        run: brew install cloudflare/cloudflare/cloudflared

      - name: Levantar Escritorio Docker
        run: |
          # 1. Iniciar Docker en macOS (tarda un poco)
          # Nota: GitHub Actions macOS tiene Docker instalado pero a veces hay que despertarlo
          
          # 2. Correr un contenedor con Escritorio Web y VNC integrado
          # Usamos la imagen de Dorowu que es super estable
          docker run -d -p 5900:5900 -p 80:80 --privileged \
          -e VNC_PASSWORD=123456 \
          -e RESOLUTION=1280x720 \
          dorowu/ubuntu-desktop-lxde-vnc
          
          echo "‚úÖ Contenedor de escritorio iniciado."

      - name: Iniciar T√∫nel
        run: |
          # Crear t√∫nel al puerto 80 (Escritorio Web)
          cloudflared tunnel --url http://localhost:80 > tunnel.log 2>&1 &
          
          sleep 30
          echo "-------------------------------------------------------"
          echo "üîó TU ESCRITORIO WEB EST√Å AQU√ç:"
          URL=$(grep -oE "https://[a-zA-Z0-9.-]+\.trycloudflare\.com" tunnel.log)
          echo "$URL"
          echo "-------------------------------------------------------"
          echo "üîë Password si la pide: 123456"
          echo "-------------------------------------------------------"
          
          sleep 21600
