name: macOS GUI Remote (6 Horas) - FIXED

on: 
  workflow_dispatch:

jobs:
  gui-session:
    runs-on: macos-latest
    timeout-minutes: 360 
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Conectar a Tailscale
        uses: tailscale/github-action@v3
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          version: latest
          args: --ssh --hostname=github-mac-gui

      - name: Activar Escritorio Remoto (VNC)
        run: |
          echo "üñ•Ô∏è Configurando VNC..."
          VNC_PASSWORD="Secreto123!"
          
          # Configuraci√≥n est√°ndar de Apple Remote Desktop
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
          -activate -configure -access -on \
          -clientopts -setvnclegacy -vnclegacy yes \
          -clientopts -setvncpw -vncpw "$VNC_PASSWORD" \
          -restart -agent -privs -all
          
          echo "‚úÖ VNC Activado."

      - name: Informaci√≥n de Conexi√≥n
        run: |
          echo "-------------------------------------------------------"
          echo "üîç Verificando instalaci√≥n..."
          which tailscale
          echo "-------------------------------------------------------"
          echo "üì° IP DE TAILSCALE:"
          # CORRECCI√ìN AQU√ç: Usamos el comando directo, no la ruta absoluta
          TS_IP=$(tailscale ip -4)
          echo "$TS_IP"
          echo "-------------------------------------------------------"
          echo "üëÄ C√ìMO VER EL ESCRITORIO:"
          echo "1. Abre tu visor VNC (RealVNC, Remmina, o Compartir Pantalla)."
          echo "2. Con√©ctate a: $TS_IP"
          echo "   (O usa el hostname: github-mac-gui)"
          echo "3. La contrase√±a es: Secreto123!"
          echo "-------------------------------------------------------"
          echo "‚è≥ Manteniendo sesi√≥n viva por 6 horas..."
          
          sleep 21600
