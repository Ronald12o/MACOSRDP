name: macOS GUI Directo (6 Horas) - SIN TARJETA

on: 
  workflow_dispatch:

jobs:
  gui-session:
    runs-on: macos-latest
    timeout-minutes: 360 

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Configurar VNC (Escritorio Gráfico)
        run: |
          VNC_PASSWORD="Secreto123!"
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
          -activate -configure -access -on \
          -clientopts -setvnclegacy -vnclegacy yes \
          -clientopts -setvncpw -vncpw "$VNC_PASSWORD" \
          -restart -agent -privs -all
          echo "✅ Escritorio remoto activado."

      - name: Iniciar Túnel con tmate
        uses: mxschmitt/action-tmate@v3
        with:
          # Esto crea el túnel y detiene el workflow ahí para que puedas entrar
          limit-access-to-actor: false 

      - name: Mantener vivo
        run: sleep 21600
